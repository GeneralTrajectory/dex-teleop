# Vive Tracker Teleoperation System Diagram

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PHYSICAL HARDWARE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Base Station â”‚    â”‚ Base Station â”‚    â”‚ Vive Tracker â”‚     â”‚
â”‚  â”‚   (Green)    â”‚â—„â”€â”€â–ºâ”‚   (Green)    â”‚â—„â”€â”€â–ºâ”‚   (Blue)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â–²                    â–²                    â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                              â”‚                                  â”‚
â”‚                         SteamVR Tracking                        â”‚
â”‚                              â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SOFTWARE STACK                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â–¼                                  â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                      â”‚   SteamVR     â”‚                          â”‚
â”‚                      â”‚  (OpenVR API) â”‚                          â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                   â”‚ ViveTrackerModule    â”‚                      â”‚
â”‚                   â”‚  (track.py)          â”‚                      â”‚
â”‚                   â”‚  â€¢ get_T() â†’ 4Ã—4     â”‚                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚   ViveToXArmMapper            â”‚                  â”‚
â”‚              â”‚   (vive_teleop_xarm.py)       â”‚                  â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚              â”‚ 1. calibrate_home_poses()     â”‚                  â”‚
â”‚              â”‚    â€¢ tracker_home â† get_T()   â”‚                  â”‚
â”‚              â”‚    â€¢ arm_home â† current TCP   â”‚                  â”‚
â”‚              â”‚                               â”‚                  â”‚
â”‚              â”‚ 2. compute_target_pose()      â”‚                  â”‚
â”‚              â”‚    â€¢ Î” = current - home       â”‚                  â”‚
â”‚              â”‚    â€¢ target = home + Î”Ã—scale  â”‚                  â”‚
â”‚              â”‚                               â”‚                  â”‚
â”‚              â”‚ 3. is_pose_safe()             â”‚                  â”‚
â”‚              â”‚    â€¢ Workspace bounds         â”‚                  â”‚
â”‚              â”‚    â€¢ Table collision          â”‚                  â”‚
â”‚              â”‚    â€¢ Joint1 limits            â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚   XArmAdapter            â”‚                       â”‚
â”‚              â”‚   (xarm_adapter.py)      â”‚                       â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
â”‚              â”‚ â€¢ _move_position()       â”‚                       â”‚
â”‚              â”‚ â€¢ pose_collides_table()  â”‚                       â”‚
â”‚              â”‚ â€¢ go_home()              â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                  â”‚  xArm SDK     â”‚                              â”‚
â”‚                  â”‚  (XArmAPI)    â”‚                              â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ROBOT HARDWARE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â–¼                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                  â”‚  xArm Robot   â”‚                              â”‚
â”‚                  â”‚  192.168.1.214â”‚                              â”‚
â”‚                  â”‚               â”‚                              â”‚
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                              â”‚
â”‚                  â”‚  â”‚ Inspire â”‚  â”‚                              â”‚
â”‚                  â”‚  â”‚ Gripper â”‚  â”‚                              â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                              â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Control Flow (30 Hz Loop)

```
START
  â”‚
  â”œâ”€â–º Initialize ViveTrackerModule
  â”‚   â””â”€â–º Detect trackers via OpenVR
  â”‚
  â”œâ”€â–º Initialize XArmAdapter
  â”‚   â””â”€â–º Connect to xArm at XARM_IP
  â”‚
  â”œâ”€â–º Move arm to HOME_POSE
  â”‚   â””â”€â–º x=275, y=0, z=670, roll=180, pitch=-1, yaw=0
  â”‚
  â”œâ”€â–º Calibrate (3 seconds)
  â”‚   â”œâ”€â–º Countdown: 3... 2... 1...
  â”‚   â”œâ”€â–º tracker_home â† tracker.get_T()
  â”‚   â””â”€â–º arm_home â† arm.get_position()
  â”‚
  â””â”€â–º CONTROL LOOP (30 Hz) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â–º Get tracker pose
      â”‚   â””â”€â–º current_T = tracker.get_T()
      â”‚
      â”œâ”€â–º Compute delta
      â”‚   â”œâ”€â–º Î”_T = inv(tracker_home) @ current_T
      â”‚   â”œâ”€â–º Î”_pos = Î”_T[:3,3] Ã— position_scale
      â”‚   â””â”€â–º Î”_rot = rotation_delta Ã— rotation_scale
      â”‚
      â”œâ”€â–º Compute target
      â”‚   â”œâ”€â–º target_pos = arm_home_pos + Î”_pos Ã— 1000
      â”‚   â”œâ”€â–º target_rot = arm_home_rot @ Î”_rot
      â”‚   â””â”€â–º target_pose = {x, y, z, roll, pitch, yaw}
      â”‚
      â”œâ”€â–º SAFETY VALIDATION
      â”‚   â”‚
      â”‚   â”œâ”€â–º Check workspace bounds
      â”‚   â”‚   â”œâ”€ X in [100, 450] mm?
      â”‚   â”‚   â”œâ”€ Y in [-400, 400] mm?
      â”‚   â”‚   â””â”€ Z in [TABLE_Z+50, 800] mm?
      â”‚   â”‚       â”‚
      â”‚   â”‚       â”œâ”€ NO â”€â”€â–º REJECT â”€â”€â”
      â”‚   â”‚       â””â”€ YES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚   â”‚                           â”‚
      â”‚   â”œâ”€â–º Check table collision   â”‚
      â”‚   â”‚   â”œâ”€ Convert to base_T_tcpâ”‚
      â”‚   â”‚   â”œâ”€ Sample gripper pointsâ”‚
      â”‚   â”‚   â””â”€ Any point < TABLE_Z? â”‚
      â”‚   â”‚       â”‚                    â”‚
      â”‚   â”‚       â”œâ”€ YES â”€â”€â–º REJECT â”€â”€â”¤
      â”‚   â”‚       â””â”€ NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚   â”‚                           â”‚
      â”‚   â””â”€â–º Check joint limits      â”‚
      â”‚       â”œâ”€ Get IK solution      â”‚
      â”‚       â””â”€ Joint1 in [-90,90]Â°? â”‚
      â”‚           â”‚                    â”‚
      â”‚           â”œâ”€ NO â”€â”€â–º REJECT â”€â”€â”€â”€â”¤
      â”‚           â””â”€ YES               â”‚
      â”‚                                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[SAFE?]â—„â”€â”€â”˜
      â”‚                        â”‚
      â”œâ”€ NO â”€â”€â–º Hold last safe pose
      â”‚         Log violation
      â”‚         Continue loop
      â”‚
      â””â”€ YES â”€â–º Execute motion
                â”œâ”€â–º arm.set_position(**target_pose, speed=200)
                â”œâ”€â–º Update last_safe_pose
                â””â”€â–º Continue loop
                â”‚
                â”œâ”€ Rate limiting
                â”‚  â””â”€â–º sleep((1/30) - elapsed)
                â”‚
                â””â”€â–º Loop back to top â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Safety Validation Flow

```
Target Pose {x, y, z, roll, pitch, yaw}
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAYER 1: Workspace Boundaries     â”‚
â”‚   â€¢ Fast (< 1 ms)                   â”‚
â”‚   â€¢ Simple numeric checks           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   X: 100 â‰¤ x â‰¤ 450 mm              â”‚
â”‚   Y: -400 â‰¤ y â‰¤ 400 mm             â”‚
â”‚   Z: TABLE_Z+50 â‰¤ z â‰¤ 800 mm       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    [Out of bounds?]
          â”‚
    YES â”€â”€â”´â”€â”€â–º REJECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                          â”‚
         NO                          â”‚
          â”‚                          â”‚
          â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAYER 2: Table Collision          â”‚
â”‚   â€¢ Medium (2-3 ms)                 â”‚
â”‚   â€¢ Geometric sampling              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   1. Convert to base_T_tcp matrix   â”‚
â”‚   2. Sample 12 points along gripper â”‚
â”‚   3. Account for gripper radius     â”‚
â”‚   4. Check each: z < TABLE_Z+CLEAR? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
  [Collision detected?]
          â”‚
    YES â”€â”€â”´â”€â”€â–º REJECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                          â”‚
         NO                          â”‚
          â”‚                          â”‚
          â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAYER 3: Joint Limits             â”‚
â”‚   â€¢ Slow (3-5 ms)                   â”‚
â”‚   â€¢ IK solver + kinematic check     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   1. Compute IK solution            â”‚
â”‚   2. Check joint1 angle             â”‚
â”‚   3. Verify: -90Â° â‰¤ J1 â‰¤ 90Â°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
   [IK failed or J1 out?]
          â”‚
    YES â”€â”€â”´â”€â”€â–º REJECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                          â”‚
         NO                          â”‚
          â”‚                          â”‚
          â–¼                          â”‚
      [SAFE!]                        â”‚
          â”‚                          â”‚
          â”œâ”€â–º Execute Motion         â”‚
          â”‚   â””â”€â–º arm.set_position() â”‚
          â”‚                          â”‚
          â””â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  REJECTED
                  â””â”€â–º Hold last safe pose
                      Log reason
```

## Coordinate Transformations

### Calibration Phase

```
t = 0s: Start calibration countdown
        â†“
t = 3s: Capture reference poses
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tracker_home = tracker.get_T()                        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ 1.000  0.000  0.000  â”‚ 0.123 â† x (m)                â”‚
â”‚  â”‚ 0.000  1.000  0.000  â”‚ 0.456 â† y (m)                â”‚
â”‚  â”‚ 0.000  0.000  1.000  â”‚ 0.789 â† z (m)                â”‚
â”‚  â”‚ 0.000  0.000  0.000  â”‚ 1.000                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚         â–²                                               â”‚
â”‚         â””â”€ Rotation    Translation â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  arm_home = arm.get_position()                         â”‚
â”‚                                                         â”‚
â”‚  Position (mm): x=275.0, y=0.0, z=670.0                â”‚
â”‚  Orientation (deg): roll=180.0, pitch=-1.0, yaw=0.0    â”‚
â”‚                                                         â”‚
â”‚  As matrix (base_T_tcp_home):                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ -1.000  0.000  0.000  â”‚ 0.275 â† x (m)               â”‚
â”‚  â”‚  0.000 -1.000 -0.017  â”‚ 0.000 â† y (m)               â”‚
â”‚  â”‚  0.000 -0.017  1.000  â”‚ 0.670 â† z (m)               â”‚
â”‚  â”‚  0.000  0.000  0.000  â”‚ 1.000                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Runtime Delta Computation

```
t = 5s (example): User moves tracker right by 10cm
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  current_tracker = tracker.get_T()                     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ 1.000  0.000  0.000  â”‚ 0.223 â† x (m)                â”‚
â”‚  â”‚ 0.000  1.000  0.000  â”‚ 0.456 â† y (m)                â”‚
â”‚  â”‚ 0.000  0.000  1.000  â”‚ 0.789 â† z (m)                â”‚
â”‚  â”‚ 0.000  0.000  0.000  â”‚ 1.000                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
            Compute Delta
        Î”_T = inv(tracker_home) @ current_tracker
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Î”_T (delta transformation):                           â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ 1.000  0.000  0.000  â”‚ 0.100 â† Î”x = 0.1m (10cm)    â”‚
â”‚  â”‚ 0.000  1.000  0.000  â”‚ 0.000 â† Î”y = 0m              â”‚
â”‚  â”‚ 0.000  0.000  1.000  â”‚ 0.000 â† Î”z = 0m              â”‚
â”‚  â”‚ 0.000  0.000  0.000  â”‚ 1.000                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚         â–²                                               â”‚
â”‚         â””â”€ No rotation change (identity matrix)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
              Apply Scaling
        Î”_pos_scaled = Î”_pos Ã— 1.5 Ã— 1000
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scaled delta (mm):                                    â”‚
â”‚  Î”x_scaled = 0.100 m Ã— 1.5 Ã— 1000 = 150.0 mm          â”‚
â”‚  Î”y_scaled = 0.000 m Ã— 1.5 Ã— 1000 = 0.0 mm            â”‚
â”‚  Î”z_scaled = 0.000 m Ã— 1.5 Ã— 1000 = 0.0 mm            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
            Add to Home Pose
        target = arm_home + Î”_scaled
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  target_pose (xArm command):                           â”‚
â”‚                                                         â”‚
â”‚  x = 275.0 + 150.0 = 425.0 mm                         â”‚
â”‚  y = 0.0 + 0.0 = 0.0 mm                               â”‚
â”‚  z = 670.0 + 0.0 = 670.0 mm                           â”‚
â”‚  roll = 180.0Â° (unchanged)                             â”‚
â”‚  pitch = -1.0Â° (unchanged)                             â”‚
â”‚  yaw = 0.0Â° (unchanged)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
             Safety Check
                  â†“
          Execute if Safe
```

## Safety Check Decision Tree

```
                    Target Pose
                        â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ X in bounds?  â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                YES â”‚       â”‚ NO
                    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â–º REJECT: "X out of workspace"
                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Y in bounds?  â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                YES â”‚       â”‚ NO
                    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â–º REJECT: "Y out of workspace"
                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Z in bounds?  â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                YES â”‚       â”‚ NO
                    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â–º REJECT: "Z out of workspace"
                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Convert to base_T_tcp       â”‚
                â”‚ Sample gripper geometry     â”‚
                â”‚ Check table collision?      â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                YES â”‚                     â”‚ NO
                    â”‚                     â””â”€â”€â–º REJECT: "Table collision"
                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Compute IK solution         â”‚
                â”‚ Get joint angles            â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
            SUCCESS â”‚                     â”‚ FAIL
                    â”‚                     â””â”€â”€â–º REJECT: "IK failed (unreachable)"
                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Joint1 check  â”‚
                â”‚ -90Â° â‰¤ J1 â‰¤90Â°â”‚
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                YES â”‚       â”‚ NO
                    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â–º REJECT: "Joint1 out of limits"
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   SAFE! âœ“    â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            Execute Motion
            arm.set_position(**target_pose)
```

## Data Flow Example

### Scenario: Move tracker forward 20cm

```
Initial State (t=3s):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tracker:  x=0.123m  y=0.456m  z=0.789m  (SteamVR frame)
Arm:      x=275mm   y=0mm     z=670mm   (xArm base frame)


User Action (t=5s):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Move tracker forward +0.20m (along tracker x-axis)


Computation:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
current_tracker:  x=0.323m  y=0.456m  z=0.789m
tracker_home:     x=0.123m  y=0.456m  z=0.789m
                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Î”_tracker:        Î”x=0.200m  Î”y=0.000m  Î”z=0.000m

Scaled (Ã—1.5):    Î”x=0.300m  Î”y=0.000m  Î”z=0.000m
In mm:            Î”x=300mm   Î”y=0mm     Î”z=0mm

Target (arm_home + Î”):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
target_x = 275 + 300 = 575 mm
target_y = 0 + 0 = 0 mm
target_z = 670 + 0 = 670 mm

Safety Check:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Workspace: x=575mm > 450mm max  â†’  REJECT!
Reason: "X too large (575.0 > 450.0mm)"

Result:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ Motion BLOCKED
ğŸ“ Arm holds at x=275mm (last safe position)
ğŸ”Š Print: "ğŸ›‘ Safety block: X too large (575.0 > 450.0mm)"
```

## Calibration Sequence Diagram

```
Time: t=0s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚     â”‚  Teleop    â”‚     â”‚   xArm     â”‚
â”‚            â”‚     â”‚   Script   â”‚     â”‚   Robot    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚
      â”‚ [Start script]   â”‚                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ go_home()        â”‚
      â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                  â”‚                  â”‚ [Moving...]
      â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                  â”‚                  â”‚ [At home]
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚ "Calibrating..   â”‚                  â”‚
      â”‚  Hold steady"    â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚ [Hold tracker]   â”‚                  â”‚
      â”‚                  â”‚                  â”‚
t=1s  â”‚ "3..."           â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                  â”‚                  â”‚
t=2s  â”‚ "2..."           â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                  â”‚                  â”‚
t=3s  â”‚ "1..."           â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ tracker.get_T()  â”‚
      â”‚                  â”‚ â†’ tracker_home   â”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ get_position()   â”‚
      â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                  â”‚ â†’ arm_home       â”‚
      â”‚                  â”‚                  â”‚
      â”‚ "Teleop active"  â”‚                  â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚ [Move tracker]   â”‚                  â”‚
      â”‚                  â”‚                  â”‚
      â”‚                  â”‚ get_T() loop     â”‚
      â”‚                  â”‚ â†“                â”‚
      â”‚                  â”‚ compute_target() â”‚
      â”‚                  â”‚ â†“                â”‚
      â”‚                  â”‚ is_safe()?       â”‚
      â”‚                  â”‚ â†“                â”‚
      â”‚                  â”‚ set_position()   â”‚
      â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                  â”‚                  â”‚ [Moving...]
      â”‚                  â”‚                  â”‚
      â”‚ [Continue...]    â”‚ [30 Hz loop...]  â”‚
```

## Files and Responsibilities

```
test_vive_teleop.py
â”œâ”€ Connectivity validation
â”œâ”€ Pose streaming test
â”œâ”€ xArm connection test
â””â”€ Coordinate transform test
   â†’ Run FIRST to verify hardware setup

test_safety_features.py
â”œâ”€ Table collision tests
â”œâ”€ Joint limit tests
â”œâ”€ Workspace boundary tests
â””â”€ Integrated safety tests
   â†’ Run SECOND to verify safety logic

move_arm_to_home.py
â”œâ”€ Connect to xArm
â”œâ”€ Move to HOME_POSE
â””â”€ Verify final position
   â†’ Run BEFORE teleoperation

vive_teleop_xarm.py
â”œâ”€ ViveToXArmMapper class
â”‚  â”œâ”€ __init__: Setup connections
â”‚  â”œâ”€ calibrate_home_poses: Capture references
â”‚  â”œâ”€ compute_target_pose: Delta mapping
â”‚  â””â”€ is_pose_safe: Multi-layer validation
â”œâ”€ run_teleoperation: Main control loop
â””â”€ main: CLI interface
   â†’ Main application

launch_teleop.sh
â”œâ”€ Check SteamVR running
â”œâ”€ Set environment variables
â”œâ”€ Confirm launch
â””â”€ Run vive_teleop_xarm.py
   â†’ Convenience wrapper
```

## Success Metrics

The implementation is considered successful if:

âœ… **Functional:**
- Tracker detected and poses streamed at 30Hz
- xArm accepts commands and moves smoothly
- Calibration captures accurate reference poses
- Delta computation produces correct targets

âœ… **Safe:**
- All unsafe poses correctly blocked
- No table collisions possible (tested)
- Joint limits enforced (tested)
- Workspace boundaries respected (tested)

âœ… **Usable:**
- Clear documentation for setup and operation
- Comprehensive test suite for validation
- Helpful error messages for troubleshooting
- Emergency stop mechanisms in place

âœ… **Research-Ready:**
- Standard methodology (relative offset control)
- Extensible architecture for future enhancements
- Configuration via environment variables
- Ready for data collection integration

All criteria met! System is ready for testing with real hardware.

